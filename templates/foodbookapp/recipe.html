{% extends 'foodbookapp/base.html' %}
{% load foodbookapp_template_tags %}

{% load staticfiles %}

{% block title_block %}
	{% if recipe %}
		{{ recipe.title }}
	{% else %}
		404 Not Found
	{% endif %}
{% endblock %}

{% block css_block %}
	<link rel="stylesheet" type="text/css" href="{% static "css/recipestyle.css" %}">
	<link rel="stylesheet" type="text/css" href="{% static "css/rateit.css" %}">
{% endblock %}

{% block body_block %}
	{% if recipe %}
        <div id="recID" style="display:none;">{{ recipe.id }}</div> <!-- to update rating -->
		<div id="recipeSlug" style="display:none;">{{ recipe.slug }}</div> <!-- to update rating -->
		
       	<h1 class="recipe-title">{{ recipe.title }}</h1>
        <br>
        <div class="recipe-picture">
		<img src="{{recipe.picture_link}}">
        </div>
		<br>
        <div class="recipe-stats">
            {% if recipe.submittedBy %}
                Submitted by: {{ recipe.submitted_by}}
            {% endif %}
            Views: {{ recipe.views }}
			<br>
			<div>
				Favourites: 
				<div id = "favourite_count">
					{{recipe.favourites}}
				</div>
				{% if user.is_authenticated %}
				<button id="favourite" data-recipeid="{{recipe.id}}" class="btn btn-primary btn-sm" type="button">{% check_favourited recipe user %}</button>
				{% endif %}
			</div>	
        </div>
        <br>
		<br>
        <div></div>
	{% endif %}
       <br>
		<br>

<div class="recipe-text">
        {% if recipe.recipeText %}
        	Recipe Instructions: {{ recipe.recipeText}}
        {% endif %}
</div>

<div class = "comments">
	{% if comments %}
		<strong> User Comments: </strong>
		<br>
		<br>
		{% for comment in comments %}
			{% if comment.user.userprofile.picture %}
			<img src="{{MEDIA_URL}}{{user.userprofile.picture}}" height="60" width="60"/> <strong>{{comment.user.username}}:</strong> {{comment.body}}
			<br>
			{% else %}
				<img src="{% static "images/default.png" %}" height="60" width="60"/> <strong> {{comment.user.username}}:</strong> {{comment.body}}
				<br>
			{% endif %}
			<br>
		{% endfor %}
	{% endif %}
</div>

{% if user.is_authenticated %}
	<form id="comment_form" method="post" action="{% url 'add_comment' recipe_slug=recipe.slug %}">
		{% csrf_token %}
		<table>
			{% for field in form.visible_fields %}
				<tr>
					{{ field.errors }}
					<th>
						{{ field.help_text }}
					</th>
					<th>
						{{ field }}
					</th>
				</tr>
			{% endfor %}
		</table>
		<input type = "submit" name = "submit" value = "add comment" />
	</form>

	<br>
	<br>

	<form id="tag_form" method="post" action=".">
		{% csrf_token %}
		<input type="text" name="tag" value="add a tag" />
		<br />
		<input type="submit" name="tag_form" value="add tag" />
	</form>
{% endif %}
{% endblock %}
