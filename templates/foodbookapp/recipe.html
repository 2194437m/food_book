{% extends 'foodbookapp/base.html' %}

{% load staticfiles %}

{% block title_block %}
	{% if recipe %}
		{{ recipe.title }}
	{% endif %}
{% endblock %}

{% block css_block %}
	<link rel="stylesheet" type="text/css" href="{% static "css/recipestyle.css" %}">
	<link rel="stylesheet" type="text/css" href="{% static "css/rateit.css" %}">
{% endblock %}

{% block body_block %}

	{% if recipe %}
        <div id="recID" style="display:none;">{{ recipe.id }}</div> <!-- to update rating -->
		<div id="recipeSlug" style="display:none;">{{ recipe.slug }}</div> <!-- to update rating -->
		
       	{{ recipe.title }}
        <br>
		<img src="{{recipe.pictureLink}}">
		<br>
		{% if recipe.submittedBy %}
			Submitted by: {{ recipe.submittedBy}}
		{% endif %}
		Views: {{ recipe.views }}		
        <br>
        {% if recipe.recipeText %}
        	Recipe: {{ recipe.recipeText}}
        {% endif %}
	{% endif %}
	<br></r>Rate this recipe: <div class="rateit" id="rate"></div>
	<div>
		<span id="rateValue">no rating</span><br>
	</div>
	{% if recipe.raters > 0 %}
		<br> User Rating: {{recipe.score}}
	{%else%}
		<div id="notRated">Not yet rated. Why not rate the recipe?</div>
	{% endif %}
	<script type="text/javascript">
		$("#rate").bind('rated', function (event, value) {
			$('#rateValue').text('You\'ve rated the recipe: ' + value + " out of 5 stars"); 
			var recID = $(document).find("#recID").html();
			var theRecipeSlug = $(document).find("#recipeSlug").html();
			<!-- var data = {"recID":recID,"score":value,"theRecipeSlug":theRecipeSlug} -->
			$.post('/foodbookapp/update_rating/', {'rec_id': recID}, function(data){
				$(document).find("#notRated").hide() <!-- This whole post is breaking somewhere -->
			});
		});
		$("#rate").bind('reset', function () { $('#rateValue').text('You reset your rating'); });
</script>     
{% endblock %}
