{% extends 'foodbookapp/base.html' %}

{% load staticfiles %}

{% block title_block %}
	{% if recipe %}
		{{ recipe.title }}
	{% endif %}
{% endblock %}

{% block css_block %}
	<link rel="stylesheet" type="text/css" href="{% static "css/recipestyle.css" %}">
	<link rel="stylesheet" type="text/css" href="{% static "css/rateit.css" %}">
{% endblock %}

{% block body_block %}
	{% if recipe %}
        <div id="recID" style="display:none;">{{ recipe.id }}</div> <!-- to update rating -->
		<div id="recipeSlug" style="display:none;">{{ recipe.slug }}</div> <!-- to update rating -->
		
       	{{ recipe.title }}
        <br>
		<img src="{{recipe.pictureLink}}">
		<br>
		{% if recipe.submittedBy %}
			Submitted by: {{ recipe.submittedBy}}
		{% endif %}
		Views: {{ recipe.views }}		
        <br>
        {% if recipe.recipeText %}
        	Recipe: {{ recipe.recipeText}}
        {% endif %}
		<br>
		Recipe tags: 
		{% for tag in recipe.tags.all %}
			 {{ tag.tagTitle }},
		{% empty %}
			none!
		{% endfor %}
	{% endif %}
	
	<div id="comments">	
	<br />
	Comments: <br />
	{% for com in comments %}
		{{ com.com_body }}, by: {{com.com_user}} <br/>
	{% empty %}
		no comments yet
	{% endfor %}
	</div>
	
	{% if recipe.raters > 0 %}
		<div id="rated">Recipe Rating: {{recipe.score}}, raters: {{recipe.raters}}</div>
	{% else %}
		<div id="rated">Not yet rated. Why not rate the recipe?</div>
	{% endif %}
	<br></r>Rate this recipe: <div class="rateit" id="rate"></div>
	<div>
		<span id="rateValue">your rating</span><br>
	</div>
	
	<script type="text/javascript">
		$("#rate").on('rated', function (event, value) {
			$('#rateValue').text('You\'ve rated the recipe: ' + value + " out of 5 stars"); 
			var recID = $(document).find("#recID").html();
			var theRecipeSlug = $(document).find("#recipeSlug").html();
			$(document).find("#rated").html("testing");
			$.post('/foodbook/update_rating/', {'rec_id': recID}) ; 
		});
		$("#rate").on('reset', function () { $('#rateValue').text('You reset your rating'); });
</script>


<form id="comment_form" method="post" action=".">
	{% csrf_token %}
	<input type="text" name="comment" value="comment here" height="500" />
	<br />
	<input type="submit" name="com_form" value="post comment" />
</form>

<form id="tag_form" method="post" action=".">
	{% csrf_token %}
	<input type="text" name="tag" value="add a tag" />
	<br />
	<input type="submit" name="tag_form" value="add tag" />
</form>
{% endblock %}
